import{_ as i,c as a,o as n,ah as l}from"./chunks/framework.Bb6kz8E2.js";const g=JSON.parse('{"title":"YOLO AI 이용해서 물체 인식하기","description":"","frontmatter":{},"headers":[],"relativePath":"ai-app/yolo.md","filePath":"ai-app/yolo.md"}'),t={name:"ai-app/yolo.md"};function h(p,s,k,e,r,o){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="yolo-ai-이용해서-물체-인식하기" tabindex="-1">YOLO AI 이용해서 물체 인식하기 <a class="header-anchor" href="#yolo-ai-이용해서-물체-인식하기" aria-label="Permalink to “YOLO AI 이용해서 물체 인식하기”">​</a></h1><p>Rockchip NPU(RK3588, RK3568 등)가 탑재된 보드(Orange Pi 5, Radxa Rock 5 등)에서 <strong>RKNN-Toolkit-Lite</strong>를 사용하여 YOLO를 구동하는 방법을 알아봅시다.</p><p>이 과정은 크게 <strong>PC에서의 모델 변환</strong>과 <strong>보드에서의 추론(Inference)</strong> 두 단계로 나뉩니다. RKNN-Lite는 오직 &#39;추론&#39;만 담당하므로, 모델 변환은 반드시 PC에서 해야 합니다.</p><h2 id="기본-개념-이해" tabindex="-1">기본 개념 이해 <a class="header-anchor" href="#기본-개념-이해" aria-label="Permalink to “기본 개념 이해”">​</a></h2><p>Rockchip NPU를 사용하기 위해서는 일반적인 딥러닝 모델(<code>.pt</code>, <code>.onnx</code>)을 NPU가 이해할 수 있는 포맷(<code>.rknn</code>)으로 변경해야 합니다.</p><ul><li><strong>PC (x86 리눅스/우분투)</strong>: <code>rknn-toolkit2</code> 사용. 모델 변환 담당.</li><li><strong>보드 (ARM 리눅스)</strong>: <code>rknn-toolkit-lite2</code> 사용. 실제 실행(Inference) 담당.</li></ul><div class="warning custom-block"><p class="custom-block-title">주의</p><p>최신 칩셋(RK3588/RK3568/RK3566)은 <strong>Lite2</strong>를 사용하고, 구형 칩셋(RK3399Pro 등)은 <strong>Lite</strong>를 사용합니다.</p><p>여기서는 가장 대중적인 <strong>RK3588(Orange Pi 5 등)</strong> 기준으로 <strong>Lite2</strong>를 설명합니다.</p></div><h2 id="준비물" tabindex="-1">준비물 <a class="header-anchor" href="#준비물" aria-label="Permalink to “준비물”">​</a></h2><ol><li><strong>개발용 PC</strong>: Ubuntu 20.04 또는 22.04 권장 (모델 변환용)</li><li><strong>타겟 보드</strong>: RK3588/RK356x 기반 보드 (예: Orange Pi 5)</li><li><strong>YOLO 모델</strong>: YOLOv5 또는 YOLOv8 (ONNX 포맷 권장)</li></ol><h2 id="step-1-pc에서-모델-변환-pt-onnx-→-rknn" tabindex="-1">Step 1: PC에서 모델 변환 (PT/ONNX → RKNN) <a class="header-anchor" href="#step-1-pc에서-모델-변환-pt-onnx-→-rknn" aria-label="Permalink to “Step 1: PC에서 모델 변환 (PT/ONNX → RKNN)”">​</a></h2><p>이 단계는 <strong>PC에서</strong> 수행합니다. 보드에서는 성능 문제로 변환이 불가능하거나 매우 어렵습니다.</p><ol><li><p><strong>RKNN-Toolkit2 설치 (PC)</strong> Rockchip의 공식 GitHub에서 툴킷을 다운로드하고 설치합니다. (Docker 사용 권장)</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/ai-rockchip/rknn-toolkit2.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rknn-toolkit2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># doc 폴더의 가이드를 따라 pip install 진행</span></span></code></pre></div></li><li><p><strong>YOLO 모델 변환 코드 작성 (<code>convert.py</code>)</strong></p><p><code>rknn.config</code>와 <code>rknn.build</code>를 사용하여 ONNX를 RKNN으로 바꿉니다.</p><p><em>핵심 설정 (YOLOv5/v8 기준)</em>:</p><ul><li><code>target_platform</code>: &quot;rk3588&quot;</li><li><code>quantize</code>: True (속도를 위해 보통 i8 양자화 사용)</li></ul><div class="info custom-block"><p class="custom-block-title">팁</p><p>초보자라면 직접 변환하기보다 <strong><a href="https://github.com/ai-rockchip/rknn_model_zoo" target="_blank" rel="noreferrer">Rockchip Model Zoo</a></strong>에서 이미 변환된 YOLO 데모 모델(<code>yolov5s.rknn</code> 등)을 다운로드하여 보드에서 먼저 돌려보는 것을 강력 추천합니다.</p></div></li></ol><h2 id="step-2-보드-환경-설정" tabindex="-1">Step 2: 보드 환경 설정 <a class="header-anchor" href="#step-2-보드-환경-설정" aria-label="Permalink to “Step 2: 보드 환경 설정”">​</a></h2><p>이제 <strong>보드(Orange Pi 5 등)</strong> 터미널에서의 작업입니다.</p><ol><li><p><strong>시스템 업데이트 및 필수 라이브러리 설치</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python3-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cmake</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc</span></span></code></pre></div></li><li><p><strong>RKNN-Toolkit-Lite2 다운로드</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/ai-rockchip/rknn-toolkit-lite2.git</span></span></code></pre></div></li><li><p><strong>라이브러리 설치 (<code>pip</code>)</strong> 자신의 파이썬 버전(3.8, 3.9, 3.10 등)에 맞는 whl 파일을 찾아 설치합니다.</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rknn-toolkit-lite2/packages</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 예: 파이썬 3.8인 경우</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rknn_toolkit_lite2-x.x.x-cp38-cp38-linux_aarch64.whl</span></span></code></pre></div></li><li><p><strong>설치 확인</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;from rknnlite.api import RKNNLite; print(&#39;Success&#39;)&quot;</span></span></code></pre></div><p>에러 없이 Success가 뜨면 성공입니다.</p></li></ol><h2 id="step-3-파이썬-추론-코드-작성-실전" tabindex="-1">Step 3: 파이썬 추론 코드 작성 (실전) <a class="header-anchor" href="#step-3-파이썬-추론-코드-작성-실전" aria-label="Permalink to “Step 3: 파이썬 추론 코드 작성 (실전)”">​</a></h2><p>보드에서 실행할 <code>inference.py</code>를 작성합니다. YOLO의 경우 <strong>전처리(Resize)</strong>와 <strong>후처리(NMS)</strong> 과정이 코드에 포함되어야 합니다.</p><p>아래는 <strong>RKNNLite 사용법의 핵심 뼈대</strong>입니다.</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rknnlite.api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RKNNLite</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 설정</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RKNN_MODEL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;yolov5s.rknn&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # PC에서 변환해온 파일</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IMG_PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;test.jpg&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. RKNNLite 초기화</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rknn_lite </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RKNNLite()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 모델 로드</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rknn_lite.load_rknn(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RKNN_MODEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Load RKNN model failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ret)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 런타임 초기화 (NPU 코어 지정)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rknn_lite.init_runtime(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">core_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RKNNLite.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NPU_CORE_0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Init runtime failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ret)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 이미지 전처리 (YOLO 모델 입력 사이즈에 맞게)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 보통 640x640, RGB 변환이 필요함</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src_img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.imread(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IMG_PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.cvtColor(src_img, cv2.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">COLOR_BGR2RGB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cv2.resize(img, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">640</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">640</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.expand_dims(img, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (1, 640, 640, 3) 형태로 변경</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 추론 (Inference)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">outputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rknn_lite.inference(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">inputs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[img])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 후처리 (Post-Processing)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># outputs에는 YOLO의 Raw 데이터(박스 좌표, 클래스 점수 등)가 들어있습니다.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 여기에 NMS(Non-Maximum Suppression) 알고리즘을 적용해야 최종 박스가 나옵니다.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (후처리 코드는 길기 때문에 rknn_model_zoo의 utils를 주로 import해서 사용합니다)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Inference Done. Output shape:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, outputs[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].shape)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 리소스 해제</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rknn_lite.release()</span></span></code></pre></div><h2 id="추천-학습-루트-지름길" tabindex="-1">추천 학습 루트 (지름길) <a class="header-anchor" href="#추천-학습-루트-지름길" aria-label="Permalink to “추천 학습 루트 (지름길)”">​</a></h2><p>처음부터 모든 코드를 짜는 것은 매우 어렵습니다. Rockchip에서 제공하는 <strong>Model Zoo</strong> 예제를 실행해보는 것이 가장 빠릅니다.</p><ol><li><strong>보드에서</strong> <code>rknn_model_zoo</code>를 클론합니다.<div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/ai-rockchip/rknn_model_zoo.git</span></span></code></pre></div></li><li><code>examples/yolov5</code> 폴더로 이동합니다.</li><li>그 안에 있는 <code>python</code> 데모 코드를 실행합니다. <ul><li>이 예제 코드 안에는 복잡한 <strong>전처리/후처리(NMS, 좌표 변환) 로직이 이미 구현</strong>되어 있습니다.</li><li>이 코드를 분석하여 본인의 프로젝트에 맞게 수정하는 것이 &#39;교과서적&#39;인 학습 방법입니다.</li></ul></li></ol>`,22)])])}const c=i(t,[["render",h]]);export{g as __pageData,c as default};
